import json

class AIVulnerabilityDetector:
    def __init__(self, report_path):
        self.report_path = report_path
        self.vulnerabilities = []

    def load_report(self):
        with open(self.report_path, 'r') as f:
            self.system_report = json.load(f)

    def detect_vulnerabilities(self):
        if self.system_report['memory_percent'] > 80:
            self.vulnerabilities.append({
                "issue": "High Memory Usage",
                "detail": f"Memory usage is at {self.system_report['memory_percent']}%",
                "suggestion": "Close unnecessary applications or upgrade RAM."
            })
        
        if self.system_report['cpu_percent'] > 75:
            self.vulnerabilities.append({
                "issue": "High CPU Usage",
                "detail": f"CPU usage is at {self.system_report['cpu_percent']}%",
                "suggestion": "Check for CPU-intensive processes and close unnecessary ones."
            })

        if self.system_report['disk_usage'] > 90:
            self.vulnerabilities.append({
                "issue": "High Disk Usage",
                "detail": f"Disk usage is at {self.system_report['disk_usage']}%",
                "suggestion": "Free up disk space by deleting unnecessary files."
            })

        suspicious_processes = [proc for proc in self.system_report['running_processes'] if 'svchost' in proc['name'].lower()]
        if suspicious_processes:
            self.vulnerabilities.append({
                "issue": "Suspicious Processes",
                "detail": f"Found {len(suspicious_processes)} svchost-like processes.",
                "suggestion": "Verify processes using task manager or an anti-virus."
            })

    def generate_report(self):
        vulnerability_report_path = "data/scanning_reports/vulnerability_report.json"
        with open(vulnerability_report_path, 'w') as f:
            json.dump({"vulnerabilities": self.vulnerabilities}, f, indent=4)
        print(f"Vulnerability report with suggestions saved to {vulnerability_report_path}")
